resource "google_cloud_workstations_workstation_clusters" "<%= ctx[:primary_resource_id] %>" {
  provider		= google-beta
  location		= "us-central1"
  name 			= "<%= ctx[:vars]['cluster_name'] %>"
  network		= google_compute_network.network.id
  subnetwork	= google_compute_subnetwork.subnetwork.id
}

resource "google_cloud_workstations_workstation_configs" "<%= ctx[:primary_resource_id] %>"{
	provider				= google-beta
	location 				= "us-central1"
	name 					= "<%= ctx[:vars]['config_name'] %>"
	workstation_cluster_id 	= "<%= ctx[:vars]['cluster_name'] %>"
	host {
		gce_instance {
	    	machine_type	= "e2-medium"
	    	pool_size 		= 2
			disable_public_ip_addresses = true
			shielded_instance_config {
				enable_secure_boot 	= true
				enable_vtpm			= true
				enable_integrity_monitoring	= true
			}
			confidential_instance_config {
				enable_confidential_compute 	= true
			}
			boot_disk_size_gb = 10
	    }
	}
	persistent_directories {
		mount_path = "/test"
		gce_pd {
		  size_gb        = 100
		  reclaim_policy = "DELETE"
		}
	}


}

resource "google_compute_network" "network" {
  provider                	= google-beta
  name                    	= "<%= ctx[:vars]['cluster_name'] %>"
  auto_create_subnetworks 	= false
}

resource "google_compute_subnetwork" "subnetwork" {
  provider      = google-beta
  name          = "<%= ctx[:vars]['cluster_name'] %>"
  ip_cidr_range = "10.0.0.0/24"
  region        = "us-central1"
  network       = google_compute_network.network.name
  depends_on 	= google_compute_network.network
}
